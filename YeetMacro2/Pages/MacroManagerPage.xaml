<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:YeetMacro2.ViewModels"
             xmlns:d="clr-namespace:YeetMacro2.Data.Models"
             x:DataType="vm:MacroManagerViewModel"
             vm:ViewModelLocator.ViewModelType="{x:Type vm:MacroManagerViewModel}"
             xmlns:v="clr-namespace:YeetMacro2.Views"
             x:Class="YeetMacro2.Pages.MacroManagerPage"
             xmlns:p="clr-namespace:YeetMacro2.Pages"
             xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:fa="clr-namespace:UraniumUI.Icons.FontAwesome;assembly=UraniumUI.Icons.FontAwesome"
             xmlns:ms="clr-namespace:UraniumUI.Icons.MaterialSymbols;assembly=UraniumUI.Icons.MaterialSymbols"
             xmlns:conv="clr-namespace:YeetMacro2.Converters"
             Title="Macro Manager"
             x:Name="thisPage">
    <mct:DockLayout HorizontalSpacing="5" VerticalSpacing="5">
        <Border Stroke="{StaticResource Primary}" Padding="0" BackgroundColor="Transparent" mct:DockLayout.DockPosition="Top">
            <Grid>
                <HorizontalStackLayout Spacing="10">
                    <Label Text="Macro Set: " Margin="5,0,0,0" FontSize="Body" VerticalOptions="Center" FontAttributes="Bold" />
                    <Picker ItemsSource="{Binding MacroSets}" SelectedItem="{Binding SelectedMacroSet}" />
                    <v:ImageView FontFamily="FASolid" Glyph="{x:Static fa:Solid.Rotate}" Color="{StaticResource Primary}" 
                                 Command="{Binding UpdateMacroSetCommand}" CommandParameter="{Binding SelectedMacroSet}" 
                                 IsVisible="{Binding SelectedMacroSet, Converter={conv:NullToBoolConverter IsInverse=True}}" />
                    <v:ImageView FontFamily="FASolid" Glyph="{x:Static fa:Solid.FileCirclePlus}" Color="{StaticResource Primary}" 
                             Command="{Binding AddLocalMacroSetCommand}" 
                             IsVisible="{Binding IsExportEnabled}" />
                    <Grid>
                        <v:ImageView FontFamily="FASolid" Glyph="{x:Static fa:Solid.Globe}" Color="{StaticResource Primary}" 
                             Command="{Binding AddOnlineMacroSetCommand}" />
                        <v:ImageView Scale=".5" TranslationX="7" TranslationY="9" FontFamily="FASolid" Glyph="{x:Static fa:Solid.CirclePlus}" Color="{AppThemeBinding Light={StaticResource Background}, Dark={StaticResource BackgroundDark}}" 
                             Command="{Binding AddOnlineMacroSetCommand}" />
                    </Grid>
                    <Grid IsVisible="{Binding SelectedMacroSet, Converter={conv:NullToBoolConverter IsInverse=True}}">
                        <v:ImageView FontFamily="FASolid" Glyph="{x:Static fa:Solid.FileExport}" Color="{StaticResource Primary}" 
                             Command="{Binding ExportMacroSetCommand}" CommandParameter="{Binding SelectedMacroSet}" 
                             IsVisible="{Binding IsExportEnabled}" />
                    </Grid>
                </HorizontalStackLayout>
                <HorizontalStackLayout Spacing="10" HorizontalOptions="End">
                    <v:ImageView FontFamily="FASolid" Glyph="{x:Static fa:Solid.TrashCan}" Color="Red" 
                             Command="{Binding DeleteMacroSetCommand}" CommandParameter="{Binding SelectedMacroSet}" 
                             IsVisible="{Binding SelectedMacroSet, Converter={conv:NullToBoolConverter IsInverse=True}}" />
                    <v:ImageView FontFamily="FASolid" Glyph="{x:Static fa:Solid.FolderOpen}" Color="{StaticResource Primary}" 
                             Command="{Binding OpenAppDirectoryCommand}" IsVisible="{Binding IsOpenAppDirectoryEnabled}" />
                </HorizontalStackLayout>
            </Grid>
        </Border>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            
            <!-- Tab Headers -->
            <ScrollView Grid.Row="0" Orientation="Horizontal" HorizontalScrollBarVisibility="Never">
                <HorizontalStackLayout Spacing="2" BackgroundColor="{AppThemeBinding Light={StaticResource Background}, Dark={StaticResource BackgroundDark}}">
                    <Button x:Name="MacroSetTabButton" Text="MacroSet" Clicked="OnTabButtonClicked" CommandParameter="MacroSet" 
                            BackgroundColor="{StaticResource Primary}" TextColor="White" Padding="8,5" />
                    <Button x:Name="PatternsTabButton" Text="Patterns" Clicked="OnTabButtonClicked" CommandParameter="Patterns" 
                            BackgroundColor="Transparent" TextColor="{StaticResource Primary}" Padding="8,5" />
                    <Button x:Name="SettingsTabButton" Text="Settings" Clicked="OnTabButtonClicked" CommandParameter="Settings" 
                            BackgroundColor="Transparent" TextColor="{StaticResource Primary}" Padding="8,5" />
                    <Button x:Name="ScriptsTabButton" Text="Scripts" Clicked="OnTabButtonClicked" CommandParameter="Scripts" 
                            BackgroundColor="Transparent" TextColor="{StaticResource Primary}" Padding="8,5" />
                    <Button x:Name="DailiesTabButton" Text="Dailies" Clicked="OnTabButtonClicked" CommandParameter="Dailies" 
                            BackgroundColor="Transparent" TextColor="{StaticResource Primary}" Padding="8,5" />
                    <Button x:Name="WeekliesTabButton" Text="Weeklies" Clicked="OnTabButtonClicked" CommandParameter="Weeklies" 
                            BackgroundColor="Transparent" TextColor="{StaticResource Primary}" Padding="8,5" />
                </HorizontalStackLayout>
            </ScrollView>
            
            <!-- Tab Content -->
            <Grid Grid.Row="1">
                <!-- MacroSet Tab Content -->
                <v:MacroSetView x:Name="MacroSetTabContent" IsVisible="True" />
                
                <!-- Patterns Tab Content (Lazy Loaded) -->
                <ContentPresenter x:Name="PatternsTabContent" IsVisible="False" />
                
                <!-- Settings Tab Content (Lazy Loaded) -->
                <ContentPresenter x:Name="SettingsTabContent" IsVisible="False" />
                
                <!-- Scripts Tab Content (Lazy Loaded) -->
                <ContentPresenter x:Name="ScriptsTabContent" IsVisible="False" />
                
                <!-- Dailies Tab Content (Lazy Loaded) -->
                <ContentPresenter x:Name="DailiesTabContent" IsVisible="False" />
                
                <!-- Weeklies Tab Content (Lazy Loaded) -->
                <ContentPresenter x:Name="WeekliesTabContent" IsVisible="False" />
            </Grid>
        </Grid>
    </mct:DockLayout>
</ContentPage>
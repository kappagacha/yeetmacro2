<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pvm="clr-namespace:YeetMacro2.Platforms.Android.ViewModels"
             xmlns:vm="clr-namespace:YeetMacro2.ViewModels"
             xmlns:models="clr-namespace:YeetMacro2.Models"
             x:DataType="pvm:PromptSelectOptionViewModel"
             vm:ViewModelLocator.ViewModelType="{x:Type pvm:PromptSelectOptionViewModel}"
             xmlns:av="clr-namespace:YeetMacro2.Platforms.Android.Views"
             x:Class="YeetMacro2.Platforms.Android.Views.PromptSelectOption"
             xmlns:conv="clr-namespace:YeetMacro2.Converters"
             x:Name="thisView">
    <Grid RowDefinitions="*, Auto" VerticalOptions="Fill" HorizontalOptions="Center" Margin="20,20,20,40">
        <!-- Main Content -->
        <Border Grid.Row="0"
                BackgroundColor="{AppThemeBinding Light={StaticResource Background}, Dark={StaticResource BackgroundDark}}"
                StrokeShape="RoundRectangle 14"
                Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#4B5563}"
                StrokeThickness="0"
                WidthRequest="300"
                Shadow="{Shadow Brush=Black, Offset='0,2', Radius=10, Opacity=0.3}">
            <Grid RowDefinitions="Auto, Auto, *">
                <!-- Title/Message -->
                <Label Grid.Row="0"
                       Text="{Binding Message}"
                       FontSize="13"
                       TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"
                       HorizontalTextAlignment="Center"
                       Margin="20,16,20,12">
                    <Label.Triggers>
                        <DataTrigger TargetType="Label" Binding="{Binding Message}" Value="{x:Null}">
                            <Setter Property="IsVisible" Value="False"/>
                        </DataTrigger>
                        <DataTrigger TargetType="Label" Binding="{Binding Message}" Value="">
                            <Setter Property="IsVisible" Value="False"/>
                        </DataTrigger>
                    </Label.Triggers>
                </Label>

                <BoxView Grid.Row="1"
                         HeightRequest="0.5"
                         Color="{AppThemeBinding Light=#E5E7EB, Dark=#4B5563}"
                         VerticalOptions="Start">
                    <BoxView.Triggers>
                        <DataTrigger TargetType="BoxView" Binding="{Binding Message}" Value="{x:Null}">
                            <Setter Property="IsVisible" Value="False"/>
                        </DataTrigger>
                        <DataTrigger TargetType="BoxView" Binding="{Binding Message}" Value="">
                            <Setter Property="IsVisible" Value="False"/>
                        </DataTrigger>
                    </BoxView.Triggers>
                </BoxView>

                <!-- Options with scrolling - fills remaining space -->
                <CollectionView Grid.Row="2"
                                ItemsSource="{Binding Options}"
                                VerticalOptions="FillAndExpand">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="0"/>
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:SelectOption">
                            <Grid>
                                <Grid HeightRequest="56">
                                    <!-- Icon (if present) -->
                                    <Label IsVisible="{Binding FontFamily, Converter={conv:NullToBoolConverter IsInverse=True}}"
                                           FontFamily="{Binding FontFamily}"
                                           Text="{Binding Glyph}"
                                           FontSize="20"
                                           TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}"
                                           VerticalTextAlignment="Center"
                                           Margin="20,0,0,0"/>
                                    <!-- Option text -->
                                    <Label Text="{Binding Text}"
                                           FontSize="17"
                                           TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}"
                                           VerticalTextAlignment="Center"
                                           HorizontalTextAlignment="Center"/>
                                    <Button BackgroundColor="Transparent"
                                            CommandParameter="{Binding Text}"
                                            Command="{Binding ViewModel.SelectCommand, Source={Reference thisView}, x:DataType=av:PromptSelectOption}"/>
                                </Grid>
                                <BoxView HeightRequest="0.5"
                                         Color="{AppThemeBinding Light=#E5E7EB, Dark=#4B5563}"
                                         VerticalOptions="End"/>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </Border>

        <!-- Cancel Button - docked at bottom -->
        <Border Grid.Row="1"
                BackgroundColor="{AppThemeBinding Light={StaticResource Background}, Dark={StaticResource BackgroundDark}}"
                StrokeShape="RoundRectangle 14"
                Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#4B5563}"
                StrokeThickness="0"
                WidthRequest="300"
                Margin="0,8,0,0"
                VerticalOptions="End"
                Shadow="{Shadow Brush=Black, Offset='0,2', Radius=10, Opacity=0.3}">
            <Grid HeightRequest="56">
                <Label Text="Cancel"
                       FontSize="17"
                       TextColor="{StaticResource Primary}"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center"
                       FontAttributes="Bold"/>
                <Button BackgroundColor="Transparent"
                        Command="{Binding CancelCommand}"/>
            </Grid>
        </Border>
    </Grid>
</ContentView>
